define("2048/1.0.0/static/game/main",[],function(e){function t(){d.documentWidth>500&&(d.gridContainerWidth=500,d.cellSpace=20,d.cellSideLength=100),$("#grid-container").css({width:d.gridContainerWidth-2*d.cellSpace,height:d.gridContainerWidth-2*d.cellSpace,padding:d.cellSpace,"border-radius":.02*d.gridContainerWidth}),$(".grid-cell").css({width:d.cellSideLength,height:d.cellSideLength,border:.02*d.cellSideLength})}function o(){r(),a(),a()}function r(){for(var e=0;4>e;e++)for(var t=0;4>t;t++){var o=$("#grid-cell-"+e+"-"+t);o.css("top",d.getPostTop(e,t)),o.css("left",d.getPostLeft(e,t))}for(var e=0;4>e;e++){v[e]=new Array,g[e]=new Array;for(var t=0;4>t;t++)v[e][t]=0,g[e][t]=!1}n(),m=0,h.updateScore(m)}function n(){$(".number-cell").remove();for(var e=0;4>e;e++)for(var t=0;4>t;t++){$("#grid-container").append('<div class="number-cell" id="number-cell-'+e+"-"+t+'"></div>');var o=$("#number-cell-"+e+"-"+t);0===v[e][t]?o.css({width:"0px",height:"0px",top:d.getPostTop(e,t)+d.cellSideLength/2,left:d.getPostLeft(e,t)+d.cellSideLength/2}):(o.css({width:d.cellSideLength,height:d.cellSideLength,top:d.getPostTop(e,t),left:d.getPostLeft(e,t),"background-color":d.getNumberBackgroundColor(v[e][t]),color:d.getNumberColor(v[e][t])}).text(v[e][t]),512===v[e][t]&&o.css("font-size","40px"),v[e][t]>=1e3&&o.css("font-size","30px")),g[e][t]=!1}$(".number-cell").css("line-height",d.cellSideLength+"px"),$(".number-cell").css("font-size",.6*d.cellSideLength+"px")}function a(){if(d.nospace(v))return!1;for(var e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random())),o=0;50>o&&0!==v[e][t];)e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random())),o++;if(50===o)for(var r=0;4>r;r++)for(var n=0;4>n;n++)0===v[r][n]&&(e=r,t=n);var a=Math.random()<.5?2:4;return v[e][t]=a,h.showNumberWithAnimation(e,t,a),!0}function i(){if(!d.canMoveLeft(v))return!1;for(var e=0;4>e;e++)for(var t=1;4>t;t++)if(0!==v[e][t])for(var o=0;t>o;o++)0===v[e][o]&&d.noBlockHorizontal(e,o,t,v)?(h.showMoveAnimation(e,t,e,o),v[e][o]=v[e][t],v[e][t]=0):v[e][o]!==v[e][t]||!d.noBlockHorizontal(e,o,t,v)||g[e][o]||(h.showMoveAnimation(e,t,e,o),v[e][o]+=v[e][t],v[e][t]=0,m+=v[e][o],h.updateScore(m),g[e][o]=!0);return setTimeout(n,200),!0}function c(){if(!d.canMoveUp(v))return!1;for(var e=0;4>e;e++)for(var t=1;4>t;t++)if(0!==v[t][e])for(var o=0;t>o;o++)0===v[o][e]&&d.noBlockVertical(e,o,t,v)?(h.showMoveAnimation(t,e,o,e),v[o][e]=v[t][e],v[t][e]=0):v[o][e]!==v[t][e]||!d.noBlockVertical(e,o,t,v)||g[o][e]||(h.showMoveAnimation(t,e,o,e),v[o][e]+=v[t][e],v[t][e]=0,m+=v[o][e],g[o][e]=!0,h.updateScore(m));return setTimeout(n,200),!0}function u(){if(!d.canMoveRight(v))return!1;for(var e=0;4>e;e++)for(var t=2;t>=0;t--)if(0!==v[e][t])for(var o=3;o>t;o--)0===v[e][o]&&d.noBlockHorizontal(e,t,o,v)?(h.showMoveAnimation(e,t,e,o),v[e][o]=v[e][t],v[e][t]=0):v[e][o]!==v[e][t]||!d.noBlockHorizontal(e,t,o,v)||g[e][o]||(h.showMoveAnimation(e,t,e,o),v[e][o]+=v[e][t],v[e][t]=0,m+=v[e][o],h.updateScore(m),g[e][o]=!0);return setTimeout(n,200),!0}function s(){if(!d.canMoveDown(v))return!1;for(var e=0;4>e;e++)for(var t=2;t>=0;t--)if(0!==v[t][e])for(var o=3;o>t;o--)0===v[o][e]&&d.noBlockVertical(e,t,o,v)?(h.showMoveAnimation(t,e,o,e),v[o][e]=v[t][e],v[t][e]=0):v[o][e]!==v[t][e]||!d.noBlockVertical(e,t,o,v)||g[o][e]||(h.showMoveAnimation(t,e,o,e),v[o][e]+=v[t][e],v[t][e]=0,m+=v[o][e],g[o][e]=!0,h.updateScore(m));return setTimeout(n,200),!0}function f(){d.nospace(v)&&d.nomove(v)&&l()}function l(){alert("gameover")}var d=e("2048/1.0.0/static/game/support"),h=e("2048/1.0.0/static/game/showanimation"),v=new Array,m=0,g=new Array,p=0,M=0,b=0,w=0;$(function(){t(),o()}),$(document).keydown(function(e){switch(e.keyCode){case 37:e.preventDefault(),i()&&(setTimeout(a,210),setTimeout(f,300));break;case 38:e.preventDefault(),c()&&(setTimeout(a,210),setTimeout(f,300));break;case 39:e.preventDefault(),u()&&(setTimeout(a,210),setTimeout(f,300));break;case 40:e.preventDefault(),s()&&(setTimeout(a,210),setTimeout(f,300))}}),document.addEventListener("touchstart",function(e){p=e.touches[0].pageX,M=e.touches[0].pageY}),document.addEventListener("touchmove",function(e){e.preventDefault()}),document.addEventListener("touchend",function(e){b=e.changedTouches[0].pageX,w=e.changedTouches[0].pageY;var t=b-p,o=w-M;Math.abs(t)<.3*d.documentWidth&&Math.abs(o)<.3*d.documentWidth||(Math.abs(t)>Math.abs(o)?t>0?u()&&(setTimeout(a,210),setTimeout(f,300)):i()&&(setTimeout(a,210),setTimeout(f,300)):o>0?s()&&(setTimeout(a,210),setTimeout(f,300)):c()&&(setTimeout(a,210),setTimeout(f,300)))})}),define("2048/1.0.0/static/game/support",[],function(e,t){var o=window.screen.availWidth,r=.92*o,n=.18*o,a=.04*o;t.documentWidth=o,t.gridContainerWidth=r,t.cellSideLength=n,t.cellSpace=a,t.getPostTop=function(e){return t.cellSpace+e*(t.cellSpace+t.cellSideLength)},t.getPostLeft=function(e,o){return t.cellSpace+o*(t.cellSpace+t.cellSideLength)},t.getNumberBackgroundColor=function(e){switch(e){case 2:return"#eee4da";case 4:return"#ede0c8";case 8:return"#f2b179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e3b";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#9c0";case 1024:return"#33b5e5";case 2048:return"#09c";case 4096:return"#a6c";case 8192:return"#93c"}return"black"},t.getNumberColor=function(e){return 4>=e?"#776e65":"white"},t.nospace=function(e){for(var t=0;4>t;t++)for(var o=0;4>o;o++)if(0===e[t][o])return!1;return!0},t.canMoveLeft=function(e){for(var t=0;4>t;t++)for(var o=1;4>o;o++)if(0!==e[t][o]&&(0===e[t][o-1]||e[t][o-1]===e[t][o]))return!0;return!1},t.canMoveUp=function(e){for(var t=0;4>t;t++)for(var o=1;4>o;o++)if(0!==e[o][t]&&(0===e[o-1][t]||e[o-1][t]===e[o][t]))return!0;return!1},t.canMoveRight=function(e){for(var t=0;4>t;t++)for(var o=2;o>=0;o--)if(0!==e[t][o]&&(0===e[t][o+1]||e[t][o+1]===e[t][o]))return!0;return!1},t.canMoveDown=function(e){for(var t=0;4>t;t++)for(var o=2;o>=0;o--)if(0!==e[o][t]&&(0===e[o+1][t]||e[o+1][t]===e[o][t]))return!0},t.noBlockHorizontal=function(e,t,o,r){for(var n=t+1;o>n;n++)if(0!==r[e][n])return!1;return!0},t.noBlockVertical=function(e,t,o,r){for(var n=t+1;o>n;n++)if(0!==r[n][e])return!1;return!0},t.nomove=function(e){return canMoveUp(e)||canMoveRight(e)||canMoveDown(e)||canMoveLeft(e)?!1:!0}}),define("2048/1.0.0/static/game/showanimation",[],function(e,t){var o=e("2048/1.0.0/static/game/support");t.showNumberWithAnimation=function(e,t,r){var n=$("#number-cell-"+e+"-"+t);n.css({"background-color":o.getNumberBackgroundColor(r),color:o.getNumberColor(r)}).text(r),n.animate({width:o.cellSideLength,height:o.cellSideLength,top:o.getPostTop(e,t),left:o.getPostLeft(e,t)},100)},t.showMoveAnimation=function(e,t,r,n){var a=$("#number-cell-"+e+"-"+t);a.animate({top:o.getPostTop(r,n),left:o.getPostLeft(r,n)},200)},t.updateScore=function(e){$("#score").text(e)}});